<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bird Feeder Highlights</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:ital,wght@0,400;0,700;1,400&family=Lato:wght@400;500;700&family=EB+Garamond:ital,wght@0,500;1,400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <style>
        /* Viewer-specific styles only */
        .container {
            max-width: 1400px;
        }

        .content {
            padding: 25px 40px 40px;
        }

        .loading {
            text-align: center;
            padding: 80px 20px;
            color: var(--text-secondary);
            font-size: 1.1em;
            font-family: 'Lato', sans-serif;
            font-weight: 400;
        }

        .error {
            text-align: center;
            padding: 80px 20px;
            color: #b85450;
            font-size: 1.1em;
            background: rgba(184, 84, 80, 0.06);
            border: 2px solid rgba(184, 84, 80, 0.2);
            border-radius: 2px;
            margin: 20px;
        }

        .video-container {
            margin: 40px 0;
            border-radius: 2px;
            overflow: hidden;
            box-shadow:
                0 4px 12px var(--shadow-soft),
                0 1px 3px var(--shadow-medium);
            position: relative;
            border: 3px solid var(--earth-brown);
        }

        video {
            width: 100%;
            display: block;
            background: #000;
        }

        .play-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(45, 80, 22, 0.25);
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(2px);
        }

        .play-overlay:hover {
            background: rgba(45, 80, 22, 0.4);
        }

        .play-overlay.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .play-button {
            width: 110px;
            height: 110px;
            background: rgba(248, 245, 237, 0.95);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
            border: 3px solid var(--forest-mid);
        }

        .play-overlay:hover .play-button {
            transform: scale(1.08);
            background: var(--cream-white);
            box-shadow: 0 12px 32px rgba(0, 0, 0, 0.4);
        }

        .play-button::after {
            content: '';
            width: 0;
            height: 0;
            border-left: 32px solid var(--forest-deep);
            border-top: 22px solid transparent;
            border-bottom: 22px solid transparent;
            margin-left: 8px;
        }

        .metadata {
            background: var(--parchment-light);
            border: 1px solid var(--parchment-dark);
            border-radius: 2px;
            margin: 30px 0 0 0;
            overflow: hidden;
            box-shadow: 0 2px 6px var(--shadow-soft);
        }

        .metadata-header {
            padding: 16px 20px;
            background: var(--parchment-light);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.2s ease;
            border-bottom: 1px solid var(--parchment-dark);
        }

        .metadata-header:hover {
            background: var(--cream-white);
        }

        .metadata h2 {
            color: var(--text-primary);
            margin: 0;
            font-size: 0.95em;
            font-weight: 700;
            font-family: 'Lato', sans-serif;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .metadata-toggle {
            font-size: 0.8em;
            color: var(--bark-brown);
            transition: transform 0.2s ease;
        }

        .metadata-toggle.expanded {
            transform: rotate(180deg);
        }

        .metadata-content {
            padding: 20px;
            display: none;
            background: var(--cream-white);
        }

        .metadata-content.expanded {
            display: block;
            animation: expandDown 0.3s ease;
        }

        @keyframes expandDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .metadata-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 18px;
        }

        .metadata-item {
            padding: 14px;
            background: var(--parchment-light);
            border-radius: 2px;
            border-left: 4px solid var(--bark-brown);
            transition: all 0.2s ease;
        }

        .metadata-item:hover {
            border-left-width: 6px;
            background: var(--cream-white);
            transform: translateX(2px);
        }

        .metadata-label {
            font-size: 0.75em;
            color: var(--bark-brown);
            text-transform: uppercase;
            letter-spacing: 0.8px;
            margin-bottom: 6px;
            font-weight: 700;
        }

        .metadata-value {
            font-size: 1.25em;
            color: var(--text-primary);
            font-weight: 500;
            font-family: 'Lato', sans-serif;
        }

        .archive {
            margin-bottom: 20px;
        }

        .archive-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .archive-link {
            padding: 12px 22px;
            background: var(--cream-white);
            color: var(--text-primary);
            text-decoration: none;
            border-radius: 2px;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 500;
            border: 2px solid var(--parchment-dark);
            font-size: 0.95em;
        }

        .archive-link:hover {
            background: var(--sky-light);
            color: var(--text-primary);
            border-color: var(--sky-blue);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px var(--shadow-soft);
        }

        .archive-link.current {
            background: var(--forest-mid);
            color: var(--cream-white);
            border: 2px solid var(--forest-deep);
            cursor: default;
            font-weight: 600;
        }

        .archive-link.current:hover {
            background: var(--forest-mid);
            transform: none;
            box-shadow: none;
        }

        .tabs {
            display: flex;
            gap: 6px;
            margin-bottom: 0;
            border-bottom: 3px solid var(--parchment-dark);
            background: var(--parchment-light);
            padding: 0 20px;
        }

        .tab-button {
            padding: 16px 32px;
            background: transparent;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-size: 1.05em;
            font-weight: 600;
            color: var(--text-secondary);
            transition: all 0.25s ease;
            margin-bottom: -3px;
            font-family: 'Lato', sans-serif;
            letter-spacing: 0.3px;
            position: relative;
        }

        .tab-button::after {
            content: '';
            position: absolute;
            bottom: -3px;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--forest-mid);
            transform: scaleX(0);
            transition: transform 0.25s ease;
        }

        .tab-button:hover {
            color: var(--forest-mid);
            background: rgba(107, 142, 35, 0.05);
        }

        .tab-button.active {
            color: var(--forest-deep);
            font-weight: 700;
        }

        .tab-button.active::after {
            transform: scaleX(1);
        }

        .tab-content {
            border: 3px solid var(--parchment-dark);
            border-top: none;
            border-radius: 0 0 2px 2px;
            padding: 40px;
            background: var(--cream-white);
        }

        .tab-content.hidden {
            display: none;
        }

        .audio-explainer {
            background: var(--parchment-light);
            padding: 18px 22px;
            border-radius: 2px;
            margin-bottom: 30px;
            color: var(--text-secondary);
            font-size: 0.95em;
            line-height: 1.7;
            border-left: 4px solid var(--sky-blue);
            font-family: 'Lato', sans-serif;
        }

        .audio-stats {
            background: transparent;
            padding: 0;
        }

        .audio-stats h2 {
            color: var(--text-primary);
            margin-bottom: 24px;
            font-size: 1.5em;
            font-family: 'Merriweather', Georgia, serif;
            font-weight: 700;
            border-bottom: 2px solid var(--parchment-dark);
            padding-bottom: 12px;
        }

        .species-row {
            display: flex;
            align-items: center;
            gap: 14px;
            padding: 14px 0;
            border-bottom: 1px solid var(--parchment-dark);
            transition: background 0.2s ease;
        }

        .species-row:hover {
            background: var(--parchment-light);
            padding-left: 8px;
            margin-left: -8px;
            padding-right: 8px;
            margin-right: -8px;
        }

        .species-row:last-child {
            border-bottom: none;
        }

        .species-name {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 1em;
            min-width: 200px;
            flex-shrink: 0;
            font-family: 'Lato', sans-serif;
        }

        .bar-container {
            flex: 1;
            height: 24px;
            background: var(--parchment-light);
            border-radius: 2px;
            overflow: hidden;
            border: 1px solid var(--parchment-dark);
        }

        .bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--forest-mid) 0%, var(--olive-green) 50%, var(--sage) 100%);
            border-radius: 2px;
            transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }

        .bar-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent 0%, rgba(255, 255, 255, 0.2) 50%, transparent 100%);
        }

        .species-count {
            color: var(--forest-deep);
            font-weight: 700;
            min-width: 35px;
            text-align: right;
            font-size: 1.1em;
        }

        .species-confidence {
            color: var(--bark-brown);
            font-size: 0.9em;
            min-width: 70px;
            text-align: right;
            font-weight: 500;
        }

        .song-clip-player {
            height: 32px;
            min-width: 150px;
            max-width: 170px;
            border-radius: 2px;
        }

        .song-clip-spacer {
            min-width: 150px;
        }

        .no-audio-message {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
            font-size: 1.1em;
            font-family: 'Lato', sans-serif;
            font-weight: 400;
        }

        .visual-layout {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 40px;
            align-items: start;
        }

        .species-detected {
            position: sticky;
            top: 20px;
        }

        .species-nav-header {
            font-family: 'Merriweather', Georgia, serif;
            font-size: 1.3em;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 8px;
            letter-spacing: -0.3px;
        }

        .species-nav-subtitle {
            font-size: 0.85em;
            color: var(--bark-brown);
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 2px solid var(--parchment-dark);
            font-family: 'Lato', sans-serif;
            line-height: 1.5;
        }

        .species-group {
            margin-bottom: 28px;
        }

        .species-group-label {
            font-size: 0.75em;
            font-weight: 700;
            color: var(--bark-brown);
            text-transform: uppercase;
            letter-spacing: 1.2px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .species-group-label::before {
            content: '';
            width: 10px;
            height: 10px;
            border-radius: 50%;
            display: inline-block;
            box-shadow: 0 2px 4px var(--shadow-soft);
        }

        .species-group-label.very-probable::before {
            background: var(--forest-deep);
        }

        .species-group-label.probable::before {
            background: var(--olive-green);
        }

        .species-group-label.possible::before {
            background: var(--sage);
        }

        .species-seek-buttons {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .species-seek-button {
            padding: 12px 16px 12px 36px;
            background: var(--parchment-light);
            color: var(--text-primary);
            border: 1px solid var(--parchment-dark);
            border-left: 4px solid var(--forest-deep);
            border-radius: 2px;
            cursor: pointer;
            font-size: 0.95em;
            font-weight: 500;
            font-family: 'Lato', sans-serif;
            text-align: left;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }

        .species-seek-button::before {
            content: '▶';
            position: absolute;
            left: 14px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 0.7em;
            color: var(--forest-deep);
            opacity: 0.4;
            transition: all 0.2s ease;
        }

        .species-seek-button:hover {
            background: var(--cream-white);
            border-left-width: 6px;
            padding-left: 34px;
            box-shadow: 0 3px 10px var(--shadow-soft);
            transform: translateX(2px);
        }

        .species-seek-button:hover::before {
            opacity: 1;
            left: 12px;
        }

        .species-seek-button:active {
            transform: translateX(4px);
        }

        .species-seek-button.probable {
            border-left-color: var(--olive-green);
        }

        .species-seek-button.probable::before {
            color: var(--olive-green);
        }

        .species-seek-button.possible {
            border-left-color: var(--sage);
            opacity: 0.85;
        }

        .species-seek-button.possible::before {
            color: var(--sage);
        }

        .species-seek-button.possible:hover {
            opacity: 1;
        }

        .video-wrapper {
            min-width: 0;
        }

        @media (max-width: 1100px) {
            .visual-layout {
                grid-template-columns: 1fr;
                gap: 30px;
            }

            .species-detected {
                position: static;
                order: -1;
            }

            .species-seek-buttons {
                flex-direction: row;
                flex-wrap: wrap;
            }

            .species-seek-button {
                flex: 0 0 auto;
            }
        }

        @media (max-width: 768px) {
            .metadata-grid {
                grid-template-columns: 1fr;
            }

            .tab-button {
                padding: 12px 20px;
                font-size: 0.95em;
            }

            .species-row {
                flex-wrap: wrap;
            }

            .species-name {
                min-width: 100%;
                margin-bottom: 6px;
            }

            .species-confidence {
                min-width: 60px;
            }

            .song-clip-player {
                min-width: 110px;
                max-width: 130px;
                height: 28px;
            }

            .song-clip-spacer {
                display: none;
            }
        }

        /* Subtle entrance animations */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .container {
            animation: fadeInUp 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .metadata-item {
            animation: fadeInUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .metadata-item:nth-child(1) { animation-delay: 0.05s; }
        .metadata-item:nth-child(2) { animation-delay: 0.1s; }
        .metadata-item:nth-child(3) { animation-delay: 0.15s; }
        .metadata-item:nth-child(4) { animation-delay: 0.2s; }

        /* Info Icon & Overlay System */
        .info-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: auto;
            height: auto;
            margin-left: 6px;
            background: #A8D5F2;
            border: 1px solid #7BB8DC;
            border-radius: 3px;
            color: #1a1a1a;
            font-size: 1.05em;
            font-weight: 400;
            font-family: 'Lato', sans-serif;
            cursor: pointer;
            transition: all 0.2s ease;
            vertical-align: middle;
            padding: 3px 7px;
            line-height: 1;
        }

        .info-icon:hover,
        .info-icon:focus {
            background: #8DC2E8;
            border-color: #5BA3CC;
            color: #000;
            transform: translateY(-1px);
            outline: none;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.15);
        }

        .info-icon:focus-visible {
            outline: 2px solid var(--sky-blue);
            outline-offset: 2px;
        }

        /* Info Overlay Modal */
        .info-overlay-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(45, 47, 34, 0.75);
            backdrop-filter: blur(3px);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            opacity: 0;
            transition: opacity 0.25s ease;
        }

        .info-overlay-backdrop.visible {
            opacity: 1;
        }

        .info-overlay {
            background: var(--cream-white);
            border: 3px solid var(--forest-mid);
            border-radius: 2px;
            max-width: 600px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
            transform: translateY(20px);
            transition: transform 0.25s ease;
            position: relative;
        }

        .info-overlay-backdrop.visible .info-overlay {
            transform: translateY(0);
        }

        .info-overlay-header {
            background: var(--parchment-light);
            padding: 20px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .info-overlay-title {
            font-family: 'Merriweather', Georgia, serif;
            font-size: 1.3em;
            font-weight: 700;
            color: var(--text-primary);
            margin: 0;
        }

        .info-overlay-close {
            background: transparent;
            border: none;
            color: var(--bark-brown);
            font-size: 1.8em;
            line-height: 1;
            cursor: pointer;
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 2px;
            transition: all 0.2s ease;
        }

        .info-overlay-close:hover,
        .info-overlay-close:focus {
            background: var(--parchment-dark);
            color: var(--forest-deep);
            outline: none;
        }

        .info-overlay-close:focus-visible {
            outline: 2px solid var(--sky-blue);
            outline-offset: 2px;
        }

        .info-overlay-content {
            padding: 24px;
            font-family: 'Lato', sans-serif;
            line-height: 1.7;
            color: var(--text-primary);
        }

        .info-overlay-content p {
            margin: 0 0 16px 0;
        }

        .info-overlay-content p:last-child {
            margin-bottom: 0;
        }

        .info-overlay-content strong {
            color: var(--forest-deep);
            font-weight: 600;
        }

        .info-overlay-content ul {
            margin: 12px 0;
            padding-left: 24px;
        }

        .info-overlay-content li {
            margin-bottom: 8px;
        }

        @media (max-width: 768px) {
            .info-overlay {
                max-height: 90vh;
            }

            .info-overlay-header {
                padding: 16px 20px;
            }

            .info-overlay-content {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Bird Feeder Highlights</h1>
            <div class="subtitle">Holt, Wiltshire • Automated bird activity highlights from motion-triggered clips</div>
        </header>

        <div class="content">
            <div id="loading" class="loading" aria-live="polite">Loading latest highlights...</div>
            <div id="error" class="error" style="display: none;" role="alert"></div>
            <div id="main-content" style="display: none;">
                <!-- Archive -->
                <div class="archive" id="archive-section" style="display: none;">
                    <div class="archive-list" id="archive-list"></div>
                </div>

                <!-- Tab Navigation -->
                <div class="tabs" role="tablist" aria-label="Content tabs">
                    <button class="tab-button active" data-tab="highlights" role="tab" id="tab-highlights" aria-selected="true" aria-controls="highlights-tab">Highlights</button>
                    <button class="tab-button" data-tab="video-stats" role="tab" id="tab-video-stats" aria-selected="false" aria-controls="video-stats-tab">Video Stats</button>
                    <button class="tab-button" data-tab="audio-stats" role="tab" id="tab-audio-stats" aria-selected="false" aria-controls="audio-stats-tab">Audio Stats</button>
                </div>

                <!-- Highlights Tab -->
                <div class="tab-content" id="highlights-tab" role="tabpanel" aria-labelledby="tab-highlights">
                    <div class="visual-layout">
                        <!-- Species detected (populated by JS if available) -->
                        <div id="species-detected" class="species-detected" style="display: none;"></div>

                        <div class="video-wrapper">
                            <!-- Video player -->
                            <div class="video-container">
                                <video id="highlights-player" controls preload="metadata">
                                    <source id="video-source" src="" type="video/mp4">
                                    Your browser does not support the video tag.
                                </video>
                                <div class="play-overlay" id="play-overlay" role="button" tabindex="0" aria-label="Play video">
                                    <div class="play-button"></div>
                                </div>
                            </div>

                            <!-- Metadata -->
                            <div class="metadata">
                                <div class="metadata-header" id="metadata-header">
                                    <h2>Batch Information</h2>
                                    <span class="metadata-toggle">▼</span>
                                </div>
                                <div class="metadata-content" id="metadata-content">
                                    <div class="metadata-grid" id="metadata-container"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Video Stats Tab -->
                <div class="tab-content hidden" id="video-stats-tab" role="tabpanel" aria-labelledby="tab-video-stats">
                    <div class="audio-explainer">
                        Bird species are visually identified using BioCLIP analysis of motion-triggered video clips. Detections represent birds visible on camera during recording periods.
                    </div>
                    <div class="audio-stats" id="video-stats-container">
                        <!-- Populated by JavaScript -->
                    </div>
                </div>

                <!-- Audio Stats Tab -->
                <div class="tab-content hidden" id="audio-stats-tab" role="tabpanel" aria-labelledby="tab-audio-stats">
                    <div class="audio-explainer">
                        Bird vocalisations detected from background sound in motion-triggered clips. Birds were likely off-camera.
                    </div>
                    <div class="audio-stats" id="audio-stats-container">
                        <!-- Populated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>

        <footer>
            Powered by birdbird |
            <a href="credits.html">Credits</a> |
            <a href="accessibility.html">Accessibility</a>
            <div style="font-size: 0.85em; margin-top: 12px; opacity: 0.8;">
                Bird detection using YOLOv8 trained on
                <a href="https://cocodataset.org/">COCO dataset</a>
                (<a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a>)
            </div>
        </footer>
    </div>

    <!-- Info Overlay Content Templates -->
    <template id="info-best-sighting">
        <div class="info-overlay-content">
            <p>For each bird species we detect, we find the "best sighting" by analysing all the moments where that bird appeared in the video.</p>

            <p><strong>How it works:</strong></p>
            <p>We look at every possible 10-15 second window in the video and add up the confidence scores for each detection of that species within the window. The window with the highest total score becomes the "best sighting" for that bird.</p>

            <p>This means the best moment is usually when the species appears multiple times, stays in view longer, or when we're very confident in the identification - or a combination of all three.</p>

            <p>When you click on a species name, the video jumps to that moment so the following few seconds are the best view this highlights video can offer of that type of bird.</p>
                <p></p>The same species may also occur in other parts of the highlights video.</p>
        </div>
    </template>

    <script>
        // R2 bucket URL (CORS configured to allow localhost and production)
        const R2_BASE_URL = 'https://pub-975f47bf9a614239932c993acd009ad5.r2.dev';

        // Get batch ID from URL query parameter (e.g., ?batch=20250116-01)
        const urlParams = new URLSearchParams(window.location.search);
        const requestedBatch = urlParams.get('batch');

        // Info Overlay System
        class InfoOverlayManager {
            constructor() {
                this.activeOverlay = null;
                this.triggerElement = null;
                this.init();
            }

            init() {
                // Event delegation for info icons
                document.addEventListener('click', (e) => {
                    const infoIcon = e.target.closest('.info-icon');
                    if (infoIcon) {
                        e.preventDefault();
                        this.show(infoIcon.dataset.infoId, infoIcon);
                    }
                });

                // Keyboard support for info icons
                document.addEventListener('keydown', (e) => {
                    const infoIcon = e.target.closest('.info-icon');
                    if (infoIcon && (e.key === 'Enter' || e.key === ' ')) {
                        e.preventDefault();
                        this.show(infoIcon.dataset.infoId, infoIcon);
                    }
                });
            }

            show(contentId, triggerElement) {
                // Store trigger element for focus return
                this.triggerElement = triggerElement;

                // Get content from template
                const template = document.getElementById(`info-${contentId}`);
                if (!template) {
                    console.error(`Info template not found: info-${contentId}`);
                    return;
                }

                // Create backdrop and overlay
                const backdrop = document.createElement('div');
                backdrop.className = 'info-overlay-backdrop';
                backdrop.setAttribute('role', 'dialog');
                backdrop.setAttribute('aria-modal', 'true');
                backdrop.setAttribute('aria-labelledby', 'info-overlay-title');

                const overlay = document.createElement('div');
                overlay.className = 'info-overlay';

                // Create header
                const header = document.createElement('div');
                header.className = 'info-overlay-header';

                const title = document.createElement('h2');
                title.className = 'info-overlay-title';
                title.id = 'info-overlay-title';
                title.textContent = this.getTitleForContent(contentId);

                const closeButton = document.createElement('button');
                closeButton.className = 'info-overlay-close';
                closeButton.innerHTML = '×';
                closeButton.setAttribute('aria-label', 'Close information overlay');
                closeButton.addEventListener('click', () => this.hide());

                header.appendChild(title);
                header.appendChild(closeButton);

                // Clone content from template
                const content = template.content.cloneNode(true);

                overlay.appendChild(header);
                overlay.appendChild(content);
                backdrop.appendChild(overlay);

                // Add to document
                document.body.appendChild(backdrop);
                this.activeOverlay = backdrop;

                // Trap focus within overlay
                this.trapFocus(overlay);

                // Show with animation (trigger reflow for CSS transition)
                requestAnimationFrame(() => {
                    backdrop.classList.add('visible');
                });

                // Focus close button
                setTimeout(() => closeButton.focus(), 100);

                // Close on backdrop click
                backdrop.addEventListener('click', (e) => {
                    if (e.target === backdrop) {
                        this.hide();
                    }
                });

                // Close on ESC key
                this.escapeHandler = (e) => {
                    if (e.key === 'Escape') {
                        this.hide();
                    }
                };
                document.addEventListener('keydown', this.escapeHandler);
            }

            hide() {
                if (!this.activeOverlay) return;

                // Remove visible class for exit animation
                this.activeOverlay.classList.remove('visible');

                // Remove from DOM after animation
                setTimeout(() => {
                    if (this.activeOverlay && this.activeOverlay.parentNode) {
                        this.activeOverlay.parentNode.removeChild(this.activeOverlay);
                    }
                    this.activeOverlay = null;

                    // Return focus to trigger element
                    if (this.triggerElement) {
                        this.triggerElement.focus();
                        this.triggerElement = null;
                    }
                }, 250);

                // Remove ESC key listener
                if (this.escapeHandler) {
                    document.removeEventListener('keydown', this.escapeHandler);
                    this.escapeHandler = null;
                }
            }

            trapFocus(container) {
                // Get all focusable elements within the overlay
                const focusableElements = container.querySelectorAll(
                    'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
                );

                if (focusableElements.length === 0) return;

                const firstFocusable = focusableElements[0];
                const lastFocusable = focusableElements[focusableElements.length - 1];

                container.addEventListener('keydown', (e) => {
                    if (e.key !== 'Tab') return;

                    if (e.shiftKey) {
                        // Shift+Tab
                        if (document.activeElement === firstFocusable) {
                            e.preventDefault();
                            lastFocusable.focus();
                        }
                    } else {
                        // Tab
                        if (document.activeElement === lastFocusable) {
                            e.preventDefault();
                            firstFocusable.focus();
                        }
                    }
                });
            }

            getTitleForContent(contentId) {
                const titles = {
                    'best-sighting': 'How We Find the Best Sighting'
                };
                return titles[contentId] || 'Information';
            }
        }

        // Initialize info overlay system
        const infoOverlayManager = new InfoOverlayManager();

        // Track current active tab for persistence across batch changes
        let currentActiveTab = urlParams.get('tab') || 'highlights';

        async function loadBatch(batchId = null) {
            const loadingEl = document.getElementById('loading');
            const errorEl = document.getElementById('error');
            const mainContentEl = document.getElementById('main-content');

            try {
                // Fetch latest.json
                const response = await fetch(`${R2_BASE_URL}/latest.json`);
                if (!response.ok) {
                    throw new Error(`Failed to load batch index: ${response.statusText}`);
                }

                const data = await response.json();

                // Determine which batch to display
                const displayBatchId = batchId || data.latest;
                const batchInfo = data.batches.find(b => b.id === displayBatchId);

                if (!batchInfo) {
                    throw new Error(`Batch ${displayBatchId} not found`);
                }

                // Load batch metadata
                const metadataResponse = await fetch(`${R2_BASE_URL}/batches/${displayBatchId}/metadata.json`);
                if (!metadataResponse.ok) {
                    throw new Error(`Failed to load batch metadata: ${metadataResponse.statusText}`);
                }

                const metadata = await metadataResponse.json();

                // Render the batch
                renderBatch(metadata, data.batches, displayBatchId);

                // Hide loading, show content
                loadingEl.style.display = 'none';
                mainContentEl.style.display = 'block';

            } catch (error) {
                console.error('Error loading batch:', error);
                loadingEl.style.display = 'none';
                errorEl.textContent = `Error loading highlights: ${error.message}`;
                errorEl.style.display = 'block';
            }
        }

        function renderBatch(metadata, allBatches, currentBatchId) {
            // Set video source
            const videoSource = document.getElementById('video-source');
            videoSource.src = `${R2_BASE_URL}/batches/${metadata.batch_id}/highlights.mp4`;
            document.getElementById('highlights-player').load();

            // Render metadata
            const metadataContainer = document.getElementById('metadata-container');
            metadataContainer.innerHTML = '';

            // Format date range from start_date and end_date (fall back to original_date if not present)
            const dateRangeText = formatDateRangeFull(
                metadata.start_date || metadata.original_date,
                metadata.end_date || metadata.original_date
            );

            const metadataItems = [
                { label: 'Capture Date(s)', value: dateRangeText },
                { label: 'Clips Processed', value: metadata.clip_count },
                { label: 'Highlights Duration', value: formatDuration(metadata.highlights_duration) },
                { label: 'Uploaded', value: formatShortDate(metadata.uploaded) },
            ];

            metadataItems.forEach(item => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'metadata-item';
                itemDiv.innerHTML = `
                    <div class="metadata-label">${item.label}</div>
                    <div class="metadata-value">${item.value}</div>
                `;
                metadataContainer.appendChild(itemDiv);
            });

            // Render archive links
            if (allBatches.length > 1) {
                const archiveSection = document.getElementById('archive-section');
                const archiveList = document.getElementById('archive-list');
                archiveSection.style.display = 'block';
                archiveList.innerHTML = '';

                allBatches.forEach(batch => {
                    const link = document.createElement('a');
                    const isCurrent = batch.id === currentBatchId;
                    link.className = 'archive-link' + (isCurrent ? ' current' : '');

                    if (isCurrent) {
                        link.setAttribute('aria-current', 'true');
                    }

                    // Use date range for link text instead of batch ID
                    link.textContent = formatDateRangeShort(
                        batch.start_date || batch.original_date,
                        batch.end_date || batch.original_date
                    );

                    if (!isCurrent) {
                        link.href = `?batch=${batch.id}&tab=${currentActiveTab}`;
                    }

                    archiveList.appendChild(link);
                });
            }

            // Load species data for Visual tab (if available)
            loadAndRenderSpecies(metadata.batch_id);

            // Load audio data for Audio tab (pass song_clips for player)
            loadAndRenderAudio(metadata.batch_id, metadata.song_clips || []);

            // Load video stats data for Video Stats tab
            loadAndRenderVideoStats(metadata.batch_id);

            // Restore previously active tab (for batch switching)
            restoreActiveTab();
        }

        async function loadAndRenderSpecies(batchId) {
            const speciesContainer = document.getElementById('species-detected');

            try {
                // Fetch both best_clips.json and species.json
                const [bestClipsResponse, speciesResponse] = await Promise.all([
                    fetch(`${R2_BASE_URL}/batches/${batchId}/best_clips.json`),
                    fetch(`${R2_BASE_URL}/batches/${batchId}/species.json`)
                ]);

                if (!bestClipsResponse.ok) {
                    // No best_clips.json available - hide the container
                    speciesContainer.style.display = 'none';
                    return;
                }

                const bestClipsData = await bestClipsResponse.json();

                if (!bestClipsData.clips || Object.keys(bestClipsData.clips).length === 0) {
                    speciesContainer.style.display = 'none';
                    return;
                }

                // Load species detections if available
                let speciesDetections = [];
                if (speciesResponse.ok) {
                    const speciesData = await speciesResponse.json();
                    speciesDetections = speciesData.detections || [];
                }

                // Convert clips object to array with common_name and categorize
                const clipsArray = Object.entries(bestClipsData.clips).map(([commonName, data]) => {
                    const clip = {
                        common_name: commonName,
                        ...data
                    };

                    // Categorize the clip
                    if (clip.detection_count >= 4) {
                        clip.category = 'very_probable';
                    } else {
                        // Need to check max confidence from species.json
                        const clipDetections = speciesDetections.filter(det =>
                            det.species === commonName &&
                            det.timestamp_s >= clip.start_s &&
                            det.timestamp_s <= clip.end_s
                        );

                        const maxConfidence = clipDetections.length > 0
                            ? Math.max(...clipDetections.map(det => det.confidence))
                            : 0;

                        if (maxConfidence >= 0.80) {
                            clip.category = 'probable';
                        } else {
                            clip.category = 'possible';
                        }
                    }

                    return clip;
                });

                // Render grouped seek buttons
                renderSpeciesSeekButtons(clipsArray);
                speciesContainer.style.display = 'block';

            } catch (error) {
                console.error('Error loading best clips data:', error);
                speciesContainer.style.display = 'none';
            }
        }

        function renderSpeciesSeekButtons(clips) {
            const speciesContainer = document.getElementById('species-detected');
            const videoPlayer = document.getElementById('highlights-player');

            speciesContainer.innerHTML = '';

            // Add header
            const header = document.createElement('div');
            header.className = 'species-nav-header';
            header.textContent = 'Species Detections';
            speciesContainer.appendChild(header);

            // Add subtitle with info icon
            const subtitle = document.createElement('div');
            subtitle.className = 'species-nav-subtitle';
            subtitle.innerHTML = `Click to jump to best sighting <button class="info-icon" data-info-id="best-sighting" aria-label="Learn how we find the best sighting">ℹ</button>`;
            speciesContainer.appendChild(subtitle);

            // Group clips by category
            const groups = {
                very_probable: clips.filter(c => c.category === 'very_probable'),
                probable: clips.filter(c => c.category === 'probable'),
                possible: clips.filter(c => c.category === 'possible')
            };

            const groupLabels = {
                very_probable: 'Very Probable',
                probable: 'Probable',
                possible: 'Possible'
            };

            // Render each group
            ['very_probable', 'probable', 'possible'].forEach(groupKey => {
                const groupClips = groups[groupKey];
                if (groupClips.length === 0) return;

                const groupDiv = document.createElement('div');
                groupDiv.className = 'species-group';

                const labelDiv = document.createElement('div');
                labelDiv.className = `species-group-label ${groupKey.replace('_', '-')}`;
                labelDiv.textContent = groupLabels[groupKey];
                groupDiv.appendChild(labelDiv);

                const buttonsContainer = document.createElement('div');
                buttonsContainer.className = 'species-seek-buttons';

                groupClips.forEach(clip => {
                    const button = document.createElement('button');
                    button.className = 'species-seek-button';

                    if (groupKey === 'probable') {
                        button.classList.add('probable');
                    } else if (groupKey === 'possible') {
                        button.classList.add('possible');
                    }

                    button.textContent = clip.common_name;

                    // Format timestamp for aria-label
                    const minutes = Math.floor(clip.start_s / 60);
                    const seconds = Math.floor(clip.start_s % 60);
                    const timestamp = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                    button.setAttribute('aria-label', `Seek to ${clip.common_name} at ${timestamp}`);

                    // Add click handler to seek video
                    button.addEventListener('click', () => {
                        videoPlayer.currentTime = clip.start_s;
                        videoPlayer.play();

                        // Hide play overlay if visible
                        const playOverlay = document.getElementById('play-overlay');
                        if (playOverlay) {
                            playOverlay.classList.add('hidden');
                        }
                    });

                    buttonsContainer.appendChild(button);
                });

                groupDiv.appendChild(buttonsContainer);
                speciesContainer.appendChild(groupDiv);
            });
        }

        function initTabs() {
            const tabButtons = document.querySelectorAll('.tab-button');

            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const targetTab = button.dataset.tab;

                    // Save current tab for persistence
                    currentActiveTab = targetTab;

                    // Update URL without reloading page
                    const newUrl = new URL(window.location);
                    newUrl.searchParams.set('tab', targetTab);
                    history.replaceState(null, '', newUrl);

                    // Update button states
                    tabButtons.forEach(btn => {
                        btn.classList.remove('active');
                        btn.setAttribute('aria-selected', 'false');
                    });
                    button.classList.add('active');
                    button.setAttribute('aria-selected', 'true');

                    // Update content visibility
                    document.querySelectorAll('.tab-content').forEach(content => {
                        if (content.id === `${targetTab}-tab`) {
                            content.classList.remove('hidden');
                        } else {
                            content.classList.add('hidden');
                        }
                    });

                    // Update archive link hrefs to include current tab
                    updateArchiveLinks();
                });
            });
        }

        function updateArchiveLinks() {
            document.querySelectorAll('.archive-link:not(.current)').forEach(link => {
                const url = new URL(link.href);
                url.searchParams.set('tab', currentActiveTab);
                link.href = url.toString();
            });
        }

        function restoreActiveTab() {
            // Restore the previously active tab after loading new batch
            const tabButtons = document.querySelectorAll('.tab-button');

            tabButtons.forEach(btn => {
                if (btn.dataset.tab === currentActiveTab) {
                    btn.classList.add('active');
                    btn.setAttribute('aria-selected', 'true');
                } else {
                    btn.classList.remove('active');
                    btn.setAttribute('aria-selected', 'false');
                }
            });

            document.querySelectorAll('.tab-content').forEach(content => {
                if (content.id === `${currentActiveTab}-tab`) {
                    content.classList.remove('hidden');
                } else {
                    content.classList.add('hidden');
                }
            });
        }

        async function loadAndRenderAudio(batchId, songClips) {
            const audioContainer = document.getElementById('audio-stats-container');

            // Build clip map: common_name -> filename
            const clipMap = new Map();
            songClips.forEach(clip => {
                clipMap.set(clip.common_name, clip.filename);
            });

            try {
                const response = await fetch(`${R2_BASE_URL}/batches/${batchId}/songs.json`);

                if (!response.ok) {
                    audioContainer.innerHTML = '<div class="no-audio-message">No audio analysis available for this batch</div>';
                    return;
                }

                const songsData = await response.json();

                if (!songsData.detections || songsData.detections.length === 0) {
                    audioContainer.innerHTML = '<div class="no-audio-message">No bird vocalisations detected</div>';
                    return;
                }

                // Aggregate by species
                const speciesMap = new Map();
                songsData.detections.forEach(detection => {
                    const name = detection.common_name;
                    if (!speciesMap.has(name)) {
                        speciesMap.set(name, { count: 0, confidences: [] });
                    }
                    const species = speciesMap.get(name);
                    species.count++;
                    species.confidences.push(detection.confidence);
                });

                // Sort by count descending
                const sortedSpecies = Array.from(speciesMap.entries())
                    .sort((a, b) => b[1].count - a[1].count);

                const maxCount = sortedSpecies[0][1].count;

                renderAudioChart(sortedSpecies, maxCount, clipMap, batchId);

            } catch (error) {
                console.error('Error loading audio data:', error);
                audioContainer.innerHTML = '<div class="no-audio-message">Error loading audio data</div>';
            }
        }

        function renderAudioChart(speciesData, maxCount, clipMap, batchId) {
            const container = document.getElementById('audio-stats-container');

            let html = '<h2>Bird Vocalisations Detected <span style="font-weight: normal; font-size: 0.75em; color: var(--text-secondary);">(with % confidence)</span></h2>';

            speciesData.forEach(([commonName, data]) => {
                const { count, confidences } = data;
                const barWidth = (count / maxCount) * 100;

                // Format confidence display
                let confidenceText;
                if (confidences.length === 1) {
                    confidenceText = `${Math.round(confidences[0] * 100)}%`;
                } else {
                    const minConf = Math.min(...confidences);
                    const maxConf = Math.max(...confidences);
                    confidenceText = `${Math.round(minConf * 100)}-${Math.round(maxConf * 100)}%`;
                }

                // Check if we have a clip for this species
                const clipFilename = clipMap.get(commonName);
                let playerHtml;
                if (clipFilename) {
                    const clipUrl = `${R2_BASE_URL}/batches/${batchId}/song_clips/${clipFilename}`;
                    // Escape commonName for use in HTML attribute
                    const escapedName = commonName.replace(/"/g, '&quot;');
                    playerHtml = `<audio class="song-clip-player" controls preload="none" src="${clipUrl}" aria-label="${escapedName} song clip"></audio>`;
                } else {
                    playerHtml = '<span class="song-clip-spacer"></span>';
                }

                html += `
                    <div class="species-row">
                        <span class="species-name">${commonName}</span>
                        <div class="bar-container">
                            <div class="bar-fill" style="width: ${barWidth}%"></div>
                        </div>
                        <span class="species-count">${count}</span>
                        <span class="species-confidence">${confidenceText}</span>
                        ${playerHtml}
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        async function loadAndRenderVideoStats(batchId) {
            const videoStatsContainer = document.getElementById('video-stats-container');

            try {
                const response = await fetch(`${R2_BASE_URL}/batches/${batchId}/species.json`);

                if (!response.ok) {
                    videoStatsContainer.innerHTML = '<div class="no-audio-message">No species detection data available for this batch</div>';
                    return;
                }

                const speciesData = await response.json();

                if (!speciesData.detections || speciesData.detections.length === 0) {
                    videoStatsContainer.innerHTML = '<div class="no-audio-message">No bird species detected</div>';
                    return;
                }

                // Aggregate by species
                const speciesMap = new Map();
                speciesData.detections.forEach(detection => {
                    const name = detection.species;
                    if (!speciesMap.has(name)) {
                        speciesMap.set(name, { count: 0, confidences: [] });
                    }
                    const species = speciesMap.get(name);
                    species.count++;
                    species.confidences.push(detection.confidence);
                });

                // Sort by count descending
                const sortedSpecies = Array.from(speciesMap.entries())
                    .sort((a, b) => b[1].count - a[1].count);

                const maxCount = sortedSpecies[0][1].count;

                renderVideoStatsChart(sortedSpecies, maxCount);

            } catch (error) {
                console.error('Error loading video stats data:', error);
                videoStatsContainer.innerHTML = '<div class="no-audio-message">Error loading video stats data</div>';
            }
        }

        function renderVideoStatsChart(speciesData, maxCount) {
            const container = document.getElementById('video-stats-container');

            let html = '<h2>Bird Species Detected <span style="font-weight: normal; font-size: 0.75em; color: var(--text-secondary);">(with % confidence)</span></h2>';

            speciesData.forEach(([commonName, data]) => {
                const { count, confidences } = data;
                const barWidth = (count / maxCount) * 100;

                // Format confidence display
                let confidenceText;
                if (confidences.length === 1) {
                    confidenceText = `${Math.round(confidences[0] * 100)}%`;
                } else {
                    const minConf = Math.min(...confidences);
                    const maxConf = Math.max(...confidences);
                    confidenceText = `${Math.round(minConf * 100)}-${Math.round(maxConf * 100)}%`;
                }

                html += `
                    <div class="species-row">
                        <span class="species-name">${commonName}</span>
                        <div class="bar-container">
                            <div class="bar-fill" style="width: ${barWidth}%"></div>
                        </div>
                        <span class="species-count">${count}</span>
                        <span class="species-confidence">${confidenceText}</span>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        function formatDuration(seconds) {
            const minutes = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${minutes}m ${secs}s`;
        }

        function formatShortDate(isoDateString) {
            // Format as "19 Jan 2026"
            const date = new Date(isoDateString);
            const day = date.getDate();
            const month = date.toLocaleDateString('en-GB', { month: 'short' });
            const year = date.getFullYear();
            return `${day} ${month} ${year}`;
        }

        function formatDateRangeFull(startDateStr, endDateStr) {
            // Format date range for metadata section:
            // - Single day: "16 January 2026"
            // - Multi-day same month: "14-16 January 2026"
            // - Cross month: "31 January - 2 February 2026"

            const startDate = new Date(startDateStr + 'T00:00:00');
            const endDate = new Date(endDateStr + 'T00:00:00');

            const startDay = startDate.getDate();
            const endDay = endDate.getDate();
            const startMonth = startDate.toLocaleDateString('en-GB', { month: 'long' });
            const endMonth = endDate.toLocaleDateString('en-GB', { month: 'long' });
            const year = startDate.getFullYear();

            if (startDateStr === endDateStr) {
                // Single day
                return `${startDay} ${startMonth} ${year}`;
            } else if (startMonth === endMonth) {
                // Same month
                return `${startDay}-${endDay} ${startMonth} ${year}`;
            } else {
                // Different months
                return `${startDay} ${startMonth} - ${endDay} ${endMonth} ${year}`;
            }
        }

        function formatDateRangeShort(startDateStr, endDateStr) {
            // Format date range for archive links (no year):
            // - Single day: "19 Jan"
            // - Same month: "17-19 Jan"
            // - Different months: "31 Jan-2 Feb"

            const startDate = new Date(startDateStr + 'T00:00:00');
            const endDate = new Date(endDateStr + 'T00:00:00');

            const startDay = startDate.getDate();
            const endDay = endDate.getDate();
            const startMonth = startDate.toLocaleDateString('en-GB', { month: 'short' });
            const endMonth = endDate.toLocaleDateString('en-GB', { month: 'short' });

            if (startDateStr === endDateStr) {
                // Single day
                return `${startDay} ${startMonth}`;
            } else if (startMonth === endMonth) {
                // Same month
                return `${startDay}-${endDay} ${startMonth}`;
            } else {
                // Different months
                return `${startDay} ${startMonth}-${endDay} ${endMonth}`;
            }
        }

        // Play button overlay handler
        const playOverlay = document.getElementById('play-overlay');
        const videoPlayer = document.getElementById('highlights-player');

        if (playOverlay && videoPlayer) {
            // Hide overlay and play video when clicked or activated via keyboard
            function activatePlayOverlay() {
                playOverlay.classList.add('hidden');
                videoPlayer.play();
            }

            playOverlay.addEventListener('click', activatePlayOverlay);

            playOverlay.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    activatePlayOverlay();
                }
            });

            // Show overlay again when video ends or is paused
            videoPlayer.addEventListener('pause', () => {
                if (!videoPlayer.ended) {
                    // Don't show overlay on manual pause, only on ended
                    return;
                }
                playOverlay.classList.remove('hidden');
            });

            videoPlayer.addEventListener('ended', () => {
                playOverlay.classList.remove('hidden');
            });
        }

        function initMetadataToggle() {
            const header = document.getElementById('metadata-header');
            const content = document.getElementById('metadata-content');
            const toggle = document.querySelector('.metadata-toggle');

            if (!header || !content || !toggle) return;

            header.addEventListener('click', () => {
                const isExpanded = content.classList.contains('expanded');

                if (isExpanded) {
                    content.classList.remove('expanded');
                    toggle.classList.remove('expanded');
                } else {
                    content.classList.add('expanded');
                    toggle.classList.add('expanded');
                }
            });

            // Add keyboard support
            header.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    header.click();
                }
            });

            header.setAttribute('role', 'button');
            header.setAttribute('tabindex', '0');
            header.setAttribute('aria-expanded', 'false');
            header.setAttribute('aria-controls', 'metadata-content');

            // Update aria-expanded when toggled
            const observer = new MutationObserver(() => {
                const isExpanded = content.classList.contains('expanded');
                header.setAttribute('aria-expanded', isExpanded.toString());
            });
            observer.observe(content, { attributes: true, attributeFilter: ['class'] });
        }

        // Initialize tabs and load batch on page load
        initTabs();
        initMetadataToggle();
        loadBatch(requestedBatch);
    </script>
</body>
</html>
